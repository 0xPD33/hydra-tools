---
name: hydra-mail
description: Multi-agent pub/sub messaging for local coordination. Emit state changes after completing actions (file edits, test results, errors). Uses TOON encoding for 30-60% token savings.
---

# Hydra Mail - Multi-Agent Pub/Sub

Lightweight message bus for AI agents working on the same project. Requires `hydra-mail` CLI installed and initialized in the project.

## Setup

```bash
# Install hydra-mail CLI first, then in your project:
hydra-mail init --daemon
```

## Tools

### hydra_emit

Broadcast a state change to other agents.

**Parameters:**
- `channel` (required): Topic in namespace:name format
  - `repo:delta` - code changes
  - `team:status` - task updates
  - `team:alert` - errors/warnings
  - `team:question` - questions needing input
- `type` (required): Message type - `delta`, `status`, `alert`, `question`, `ack`
- `data` (required): JSON payload with `action`, `target`, `reason`, `impact`

**Command:**
```bash
if [ -d ".hydra" ]; then
  printf '%s\n' "$data" | hydra-mail emit --project . --channel "$channel" --type "$type" --data @-
else
  echo "Hydra not initialized. Run: hydra-mail init --daemon" >&2
  exit 1
fi
```

### hydra_subscribe

Listen for messages from other agents.

**Parameters:**
- `channel` (required): Channel to subscribe to
- `once` (optional, default: true): Get one message and exit

**Command:**
```bash
if [ -d ".hydra" ]; then
  if [ "$once" = "false" ]; then
    hydra-mail subscribe --project . --channel "$channel"
  else
    hydra-mail subscribe --project . --channel "$channel" --once
  fi
else
  echo "Hydra not initialized" >&2
  exit 1
fi
```

## When to Emit

**After completing:**
- File edits, refactoring → `repo:delta`
- Test runs, builds → `team:status`
- Errors, blockers → `team:alert`
- Questions → `team:question`

**Never emit:**
- Before changes (no speculation)
- During partial work
- Every small change (batch related work)

## Examples

| Action | Channel | Type | Data |
|--------|---------|------|------|
| Fixed bug | repo:delta | delta | `{"action":"fixed","target":"auth.py","impact":"login works"}` |
| Tests failed | team:alert | alert | `{"action":"test_failure","target":"unit tests","count":3}` |
| Need decision | team:question | question | `{"action":"question","topic":"API design","options":["REST","GraphQL"]}` |
| Task done | team:status | status | `{"action":"completed","task":"auth module"}` |
